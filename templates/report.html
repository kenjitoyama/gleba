{%extends "gleba_base.html"%}

{%block extrahead%}
<title>Gleba report</title>
<script src="/static/js/jquery.min.js"></script>
<script src="/static/js/jquery-ui/js/jquery-ui.min.js"></script>
<link rel="stylesheet" href="/static/js/jquery-ui/css/smoothness/jquery-ui.css" media="screen" title="Base"/>
<link rel="stylesheet" href="/static/css/report.css"/>
<!--[if IE]><script src="/static/js/jqplot/excanvas.js"></script><![endif]-->
<script src="/static/js/jqplot/jquery.jqplot.min.js"></script>
<link rel="stylesheet" href="/static/js/jqplot/jquery.jqplot.css"/>
<script src="/static/js/jqplot/plugins/jqplot.dateAxisRenderer.js"></script>
<script src="/static/js/jqplot/plugins/jqplot.canvasTextRenderer.min.js"></script>
<script src="/static/js/jqplot/plugins/jqplot.canvasAxisTickRenderer.min.js"></script>
<script src="/static/js/jqplot/plugins/jqplot.categoryAxisRenderer.min.js"></script>
<script src="/static/js/custom/report.js"></script>
<script>
    $(function() {
        Date.format = 'dd/mm/yyyy';
        $('.dateField').datepicker({dateFormat: 'dd-mm-yy'});
        var plot_data = {{jqplot_data|safe}};
        var graph_target = '{{report_type}}' + '_report_graph';
        plot_report_graph(graph_target, plot_data)
        $('.total_value').html(calculate_total(plot_data));
    });
</script>
{%endblock%}

{%block content%}
  {%ifequal report_type "picker"%}
  <h1>Picker Report :: {{picker.fullName}}</h1> 
  <div id="picker_report_graph" class="report_graph"></div>
  <table>
    <tr>
      <th>Date</th>
      <th>Mushrooms Picked (kg)</th>
      <th>Daily Average</th>
    </tr>
    {%for date, weight, dailyAverage in jqplot_data%}
    <tr>
      <td>{{date}}</td>
      <td>{{weight}}</td>
      <td>{{dailyAverage}}</td>
    </tr>
    {%endfor%}
  </table>
  {%endifequal%}

  {%ifequal report_type "room"%}
  <h1>Room Report :: {{room.number}}</h1>  
  <div id="room_report_graph" class="report_graph"></div>
  <table>
    <tr>
      <th>Date</th>
      <th>Mushrooms Picked (kg)</th>
    </tr>
    {%for date, weight in jqplot_data%}
    <tr>
      <td>{{date}}</td>
      <td>{{weight}}</td>
    </tr>
    {%endfor%}
    <tr class="total_row">
      <td>Total:</td>
      <td class="total_value"></td>
    </tr>
  </table>
  {%endifequal%}

  {%ifequal report_type "flush"%}
  <h1>Flush Report :: {{flush}}</h1> 
  <div id="flush_report_graph" class="report_graph"></div>
  <table>
    <tr>
      <th>Date</th>
      <th>Mushrooms Picked (kg)</th>
    </tr>
    {%for date, weight in jqplot_data%}
    <tr>
      <td>{{date}}</td>
      <td>{{weight}}</td>
    </tr>
    {%endfor%}
    <tr class="total_row">
      <td>Total:</td>
      <td class="total_value"></td>
    </tr>
  </table>
  {%endifequal%}

  {%ifequal report_type "crop"%}
  <h1>Crop Report :: {{crop}}</h1> 
  <div id="crop_report_graph" class="report_graph"></div>
  <table>
    <tr>
      <th>Date</th>
      <th>Mushrooms Picked (kg)</th>
    </tr>
    {%for date, weight in jqplot_data%}
    <tr>
      <td>{{date}}</td>
      <td>{{weight}}</td>
    </tr>
    {%endfor%}
    <tr class="total_row">
      <td>Total:</td>
      <td class="total_value"></td>
    </tr>
  </table>
  {%endifequal%}

  {%ifequal report_type "all_pickers"%}
  <h1>Overall Picking ({{startDate}} ~ {{endDate}})</h1> 
  <table>
    <tr>
      <th>
        <a href="?sort=fName&startDate={{startDate}}&endDate={{endDate}}">First Name</a>
      </th>
      <th>
        <a href="?sort=lName&startDate={{startDate}}&endDate={{endDate}}">Last Name</a>
      </th>
      <th>
        <a href="?sort=total_picked&startDate={{startDate}}&endDate={{endDate}}">Mushrooms Picked (kg)</a>
      </th>  
      <th>
        <a href="?sort=kpi&startDate={{startDate}}&endDate={{endDate}}">Mushrooms Picked/Hour Worked (kg/hr)</a>
      </th>
      <th>
        <a href="?sort=avgBox&startDate={{startDate}}&endDate={{endDate}}">Average Initial Box Weight (kg)</a>
      </th>
      {%for picker in data%}
      <tr>
        <td>{{picker.0}}</td>{%comment%}firstName{%endcomment%}
        <td>{{picker.1}}</td>{%comment%}lastName{%endcomment%}
        <td>{{picker.2}}</td>{%comment%}total_picked{%endcomment%}
        <td>{{picker.3}}</td>{%comment%}kpi{%endcomment%}
        <td>{{picker.4}}</td>{%comment%}avgBoxWeight{%endcomment%}
      </tr>
      {%endfor%}
  </table>
  {%endifequal%}

  {%ifequal report_type "default_page"%}
  <div>
    <h2>Picker</h2>
    <form name="picker_report_form" action="picker/" method="post" id="picker_report_form">
      <select name="picker" id="picker_menu">
        {%for picker in picker_list%}
        <option value={{picker.id}}>{{picker.id}} - {{picker.fullName}}</option>
        {%endfor%}
      </select><br/>
      <label for="picker_start_date">Start Date</label>
      <input name="startDate" class="dateField" id="picker_start_date" type="text"/><br/>
      <label for="picker_end_date">End Date</label>
      <input name="endDate" class="dateField" id="picker_end_date" type="text"/><br/>
      <input type="submit" onClick="submitForm('picker_')" value="Submit"/><br/>
    </form>
  </div>
  
  <div>
    <h2>All Pickers</h2>
    <form name="all_picker_report_form" action="picker/" method="post" id="all_picker_report_form">
      <label for="all_pickers_start_date">Start Date</label>
      <input name="startDate" class="dateField" id="all_pickers_start_date" type="text"/><br/>
      <label for="all_pickers_end_date">End Date</label>
      <input name="endDate" class="dateField" id="all_pickers_end_date" type="text"/><br/>
      <input type="submit" onClick="submitAllPickerForm()" value="Submit"/><br/>
    </form>
  </div>
      
  <div>
    <h2>Flush</h2>
    <form name="flush_report_form" action="flush/" method="post" id="flush_report_form">
      <label for="flush_menu">Flush ID</label>
      <input type="text" name="flush" id="flush_menu"/><br/>
      <input type="submit" onClick="submitForm('flush_')" value="Submit"/><br/>
    </form>
  </div>

  <div>
    <h2>Crop</h2>
    <form name="crop_report_form" action="crop/" method="post" id="crop_report_form">
      <label for="crop_menu">Crop ID</label>
      <input type="text" name="crop" id="crop_menu"/><br/>
      <input type="submit" onClick="submitForm('crop_')" value="Submit"/>
    </form>
  </div>

  <div>
    <h2>Room</h2>
    <form name="room_report_form" action="room/" method="post" id="room_report_form">
      <label for="room_menu">Room Number</label>
      <select name="room" id="room_menu">
        {%for room in room_list%}
        <option value={{room.number}}>{{room.number}}</option>
        {%endfor%}
      </select><br/>
      <label for="room_start_date">Start Date</label>
      <input name="startDate" class="dateField" id="room_start_date" type="text"/><br/>
      <label for="room_end_date">End Date</label>
      <input name="endDate" class="dateField" id="room_end_date" type="text"/><br/>
      <input type="submit" onClick="submitForm('room_')" value="Submit"/>
    </form>
  </div>
  {%endifequal%}
  {{debug}}
{%endblock%}
